&НаКлиенте

Процедура ЗагрузитьВыполнить()

Перем Имя,Адрес;

ДиалогОткрытияФайла=Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);

ДиалогОткрытияФайла.ПолноеИмяФайла = "";

Фильтр = НСтр("ru = 'Картинка'; en = 'Picture'") + "(*.jpg)|*.jpg";

ДиалогОткрытияФайла.Фильтр = Фильтр;

ДиалогОткрытияФайла.МножественныйВыбор = Ложь;

ДиалогОткрытияФайла.Заголовок = "Выберите файл c картинкой";

ДиалогОткрытияФайла.Показать(Новый ОписаниеОповещения("ЗагрузитьВыполнитьЗавершение1", ЭтотОбъект, Новый Структура("ДиалогОткрытияФайла", ДиалогОткрытияФайла)));

КонецПроцедуры



&НаКлиенте

Процедура ЗагрузитьВыполнитьЗавершение1(ВыбранныеФайлы, ДополнительныеПараметры) Экспорт


ДиалогОткрытияФайла = ДополнительныеПараметры.ДиалогОткрытияФайла;



Если (ВыбранныеФайлы <> Неопределено) Тогда

МассивФайлов = ДиалогОткрытияФайла.ВыбранныеФайлы;

НачатьПомещениеФайлаНаСервер(Новый ОписаниеОповещения("ЗагрузитьВыполнитьЗавершение3",ЭтотОбъект),,,,МассивФайлов[0],УникальныйИдентификатор);

Иначе

ПоказатьПредупреждение(Новый ОписаниеОповещения("ЗагрузитьВыполнитьЗавершение", ЭтотОбъект), НСтр("ru = 'Файл не выбран!'; en = 'File not selected!'"));

КонецЕсли;



КонецПроцедуры



&НаКлиенте

Процедура ЗагрузитьВыполнитьЗавершение(ДополнительныеПараметры) Экспорт





КонецПроцедуры



&НаКлиенте

Процедура ЗагрузитьВыполнитьЗавершение3(ДополнительныеПараметры,П2) Экспорт


ОбновитьКартинку(ДополнительныеПараметры.Адрес);



КонецПроцедуры



&НаСервере

Процедура ОбновитьКартинку(Адрес)

АдресКартинки=Адрес;

КонецПроцедуры





&НаСервере

Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

Спр=РеквизитФормыВЗначение("Объект");

Если Спр.Картинка.Получить()<>Неопределено Тогда

АдресКартинки=ПолучитьНавигационнуюСсылку(Объект.Ссылка,"Картинка");

КонецЕсли;

КонецПроцедуры



&НаСервере

Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)

Если ЭтоАдресВременногоХранилища(АдресКартинки) Тогда

ДвоичныеДанные=ПолучитьИзВременногоХранилища(АдресКартинки);

ТекущийОбъект.Картинка=Новый ХранилищеЗначения(ДвоичныеДанные);

КонецЕсли;

КонецПроцедуры
